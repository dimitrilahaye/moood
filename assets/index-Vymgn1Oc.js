const y={moodOptions:[{value:5,label:"GÃ©nial",emotion:"Joie, gratitude, Ã©nergie",emoji:"ðŸŸ¢",color:"#4ade80"},{value:4,label:"Bien",emotion:"Calme, satisfaction, sÃ©rÃ©nitÃ©",emoji:"ðŸŸ¢",color:"#86efac"},{value:3,label:"Neutre",emotion:'Fatigue lÃ©gÃ¨re, routine, "Ã§a va"',emoji:"ðŸŸ¡",color:"#fde047"},{value:2,label:"Bof",emotion:"Stress, tristesse, agacement",emoji:"ðŸŸ ",color:"#fb923c"},{value:1,label:"Mauvais",emotion:"ColÃ¨re, dÃ©prime, Ã©puisement",emoji:"ðŸ”´",color:"#f87171"}]};function b(){const e=document.createElement("nav");e.className="main-navigation";const d=document.createElement("a");d.href="#",d.textContent="Accueil",d.className="nav-link";const n=document.createElement("a");n.href="#",n.textContent="Mes Moods",n.className="nav-link active";const t=document.createElement("a");return t.href="#",t.textContent="Bilans",t.className="nav-link",e.appendChild(d),e.appendChild(n),e.appendChild(t),e}function S(){const e=document.createElement("section");e.className="moods-list-section",e.id="moods-list-section";const d=document.createElement("h1");d.textContent="Mes Moods",e.appendChild(d);const n=document.createElement("div");n.className="filter-container";const t=document.createElement("div");t.className="filter-selector";const o=document.createElement("button");o.className="filter-button active",o.textContent="Tous",o.dataset.filter="all";const a=document.createElement("button");a.className="filter-button",a.textContent="Jour",a.dataset.filter="day";const i=document.createElement("button");i.className="filter-button",i.textContent="Semaine",i.dataset.filter="week";const s=document.createElement("button");s.className="filter-button",s.textContent="Mois",s.dataset.filter="month",t.appendChild(o),t.appendChild(a),t.appendChild(i),t.appendChild(s);const c=document.createElement("div");c.className="date-selector",c.id="list-date-selector",c.style.display="none",c.style.alignItems="center";const r=document.createElement("label");r.textContent="Date",r.htmlFor="list-date";const f=document.createElement("input");f.type="date",f.id="list-date",f.name="date",c.appendChild(r),c.appendChild(f),n.appendChild(t),n.appendChild(c),e.appendChild(n);const u=document.createElement("div");return u.className="moods-list-container",u.id="moods-list-container",e.appendChild(u),e}function N({moodsUseCase:e,onRefresh:d}){return async n=>{n.preventDefault();const t=n.target,o=new FormData(t),a=t.dataset.moodId;if(!a)return;const i=o.get("date"),s=o.get("time"),c=o.get("mood");if(!i||!s||!c)return;const[r,f,u]=String(i).split("-").map(Number),[p,l]=String(s).split(":").map(Number),m=new Date(r,f-1,u,p,l),C=Number(c);try{await e.update({id:a,note:C,datetime:m});const h=document.getElementById("edit-modal");h&&(h.style.display="none"),await d()}catch(h){console.error("Erreur lors de la mise Ã  jour du mood:",h)}}}function B({moodsUseCase:e,onRefresh:d}){return async n=>{try{await e.delete({id:n}),await d()}catch(t){console.error("Erreur lors de la suppression du mood:",t)}}}function D({moods:e,moodOptions:d}){return n=>{const t=e.find(C=>C.id===n);if(!t)return;const o=document.getElementById("edit-modal"),a=document.getElementById("edit-mood-form"),i=document.getElementById("edit-date"),s=document.getElementById("edit-time"),c=document.getElementById("edit-mood");if(!o||!a||!i||!s||!c)return;const r=new Date(t.datetime),f=r.getFullYear(),u=String(r.getMonth()+1).padStart(2,"0"),p=String(r.getDate()).padStart(2,"0"),l=String(r.getHours()).padStart(2,"0"),m=String(r.getMinutes()).padStart(2,"0");i.value=`${f}-${u}-${p}`,s.value=`${l}:${m}`,c.value=String(t.note),a.dataset.moodId=n,o.style.display="flex"}}function w({onFilterChange:e}){return d=>{const n=d.target,t=n.dataset.filter;if(!t)return;document.querySelectorAll(".filter-button").forEach(a=>{a.classList.remove("active")}),n.classList.add("active");const o=document.getElementById("list-date-selector");o&&(o.style.display=t==="all"?"none":"flex"),e(t)}}function x({onDateChange:e}){return d=>{const t=d.target.value;if(!t)return;const[o,a,i]=t.split("-").map(Number),s=new Date(o,a-1,i);e(s)}}function L({mood:e,moodOptions:d,onEdit:n,onDelete:t}){const o=document.createElement("div");o.className="mood-card";const a=d.find(v=>v.value===e.note),i=a?a.emoji:"â“",s=a?a.label:"",c=a?a.color:"#ccc",r=new Date(e.datetime),f=r.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),u=r.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),p=document.createElement("div");p.className="mood-display",p.style.backgroundColor=c;const l=document.createElement("span");l.className="mood-emoji",l.textContent=i;const m=document.createElement("span");m.className="mood-text",m.textContent=`${e.note} - ${s}`,p.appendChild(l),p.appendChild(m);const C=document.createElement("div");C.className="mood-datetime",C.textContent=`${f} Ã  ${u}`;const h=document.createElement("div");h.className="mood-actions";const g=document.createElement("button");g.className="edit-button",g.textContent="Modifier",g.addEventListener("click",()=>n(e.id));const E=document.createElement("button");return E.className="delete-button",E.textContent="Supprimer",E.addEventListener("click",async()=>{confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce mood ?")&&await t(e.id)}),h.appendChild(g),h.appendChild(E),o.appendChild(p),o.appendChild(C),o.appendChild(h),o}function I({moods:e,moodOptions:d,onEdit:n,onDelete:t}){const o=document.getElementById("moods-list-container");if(o){if(o.innerHTML="",e.length===0){const a=document.createElement("p");a.className="empty-message",a.textContent="Aucun mood enregistrÃ©",o.appendChild(a);return}e.sort((a,i)=>new Date(i.datetime)-new Date(a.datetime)),e.forEach(a=>{const i=L({mood:a,moodOptions:d,onEdit:n,onDelete:t});o.appendChild(i)})}}function M(){const e=document.getElementById("list-date");if(e){const d=new Date,n=d.getFullYear(),t=String(d.getMonth()+1).padStart(2,"0"),o=String(d.getDate()).padStart(2,"0");e.value=`${n}-${t}-${o}`}}function k({onNavigate:e}){document.querySelectorAll(".nav-link").forEach(n=>{n.addEventListener("click",t=>{t.preventDefault();const o=t.target,a=o.textContent==="Accueil"?"/":o.textContent==="Mes Moods"?"/list":o.textContent==="Bilans"?"/bilans":"/";e(a)})})}function F(){const e=document.createElement("div");e.className="edit-modal",e.id="edit-modal",e.style.display="none";const d=document.createElement("div");d.className="modal-content";const n=document.createElement("span");n.className="close-button",n.textContent="Ã—",n.addEventListener("click",()=>{e.style.display="none"});const t=document.createElement("form");t.id="edit-mood-form",t.className="edit-mood-form";const o=document.createElement("label");o.textContent="Date",o.htmlFor="edit-date";const a=document.createElement("input");a.type="date",a.id="edit-date",a.name="date",a.required=!0;const i=document.createElement("label");i.textContent="Heure",i.htmlFor="edit-time";const s=document.createElement("input");s.type="time",s.id="edit-time",s.name="time",s.required=!0;const c=document.createElement("label");c.textContent="Mood";const r=document.createElement("select");r.id="edit-mood",r.name="mood",r.required=!0,[{value:"5",label:"5 - GÃ©nial ðŸŸ¢"},{value:"4",label:"4 - Bien ðŸŸ¢"},{value:"3",label:"3 - Neutre ðŸŸ¡"},{value:"2",label:"2 - Bof ðŸŸ "},{value:"1",label:"1 - Mauvais ðŸ”´"}].forEach(p=>{const l=document.createElement("option");l.value=p.value,l.textContent=p.label,r.appendChild(l)});const u=document.createElement("button");return u.type="submit",u.textContent="Enregistrer",t.appendChild(o),t.appendChild(a),t.appendChild(i),t.appendChild(s),t.appendChild(c),t.appendChild(r),t.appendChild(u),d.appendChild(n),d.appendChild(t),e.appendChild(d),e}async function H({root:e,params:d,deps:n}){e.innerHTML="";const t=b(),o=S(),a=F();e.appendChild(t),e.appendChild(o),e.appendChild(a),M();let i="all",s=new Date;const c=async()=>{let l;if(i==="all")l=await n.moodsUseCase.getAll();else if(i==="day")l=await n.moodsUseCase.getByDate({date:s});else if(i==="week"){const m=new Date(s),C=m.getDay(),h=C===0?-6:1-C;m.setDate(m.getDate()+h),m.setHours(0,0,0,0),l=await n.moodsUseCase.getByWeek({weekStart:m})}else if(i==="month"){const m=new Date(s.getFullYear(),s.getMonth(),1);l=await n.moodsUseCase.getByMonth({monthStart:m})}else l=await n.moodsUseCase.getAll();I({moods:l,moodOptions:y.moodOptions,onEdit:D({moods:l,moodOptions:y.moodOptions}),onDelete:B({moodsUseCase:n.moodsUseCase,onRefresh:c})})},r=async()=>{await c()};await c(),document.querySelectorAll(".filter-button").forEach(l=>{const m=w({onFilterChange:C=>{i=C,c()}});l.addEventListener("click",m)});const u=document.getElementById("list-date");if(u){const l=x({onDateChange:m=>{s=m,c()}});u.addEventListener("change",l)}const p=document.getElementById("edit-mood-form");if(p){const l=N({moodsUseCase:n.moodsUseCase,onRefresh:r});p.addEventListener("submit",l)}k({onNavigate:l=>{const m=window.router;m&&m.navigate(l)}})}export{H as renderListPage};
