const N={moodOptions:[{value:5,label:"G√©nial",emotion:"Joie, gratitude, √©nergie",emoji:"üü¢",color:"#4ade80"},{value:4,label:"Bien",emotion:"Calme, satisfaction, s√©r√©nit√©",emoji:"üü¢",color:"#86efac"},{value:3,label:"Neutre",emotion:'Fatigue l√©g√®re, routine, "√ßa va"',emoji:"üü°",color:"#fde047"},{value:2,label:"Bof",emotion:"Stress, tristesse, agacement",emoji:"üü†",color:"#fb923c"},{value:1,label:"Mauvais",emotion:"Col√®re, d√©prime, √©puisement",emoji:"üî¥",color:"#f87171"}]},B={copySuccess:"Bilan copi√© dans le presse-papier !",copyError:"Erreur lors de la copie",noData:"Aucune donn√©e disponible pour cette p√©riode"};function x(){const e=document.createElement("nav");e.className="main-navigation";const r=document.createElement("a");r.href="#",r.textContent="Accueil",r.className="nav-link";const n=document.createElement("a");n.href="#",n.textContent="Mes Moods",n.className="nav-link";const a=document.createElement("a");return a.href="#",a.textContent="Bilans",a.className="nav-link active",e.appendChild(r),e.appendChild(n),e.appendChild(a),e}function k(){const e=document.createElement("section");e.className="bilans-section";const r=document.createElement("h1");r.textContent="Bilans";const n=document.createElement("div");n.className="period-selector";const a=document.createElement("button");a.className="period-button active",a.textContent="Jour",a.dataset.period="day";const c=document.createElement("button");c.className="period-button",c.textContent="Semaine",c.dataset.period="week";const l=document.createElement("button");l.className="period-button",l.textContent="Mois",l.dataset.period="month",n.appendChild(a),n.appendChild(c),n.appendChild(l);const o=document.createElement("div");o.className="date-selector";const s=document.createElement("label");s.textContent="Date",s.htmlFor="bilan-date";const h=document.createElement("input");h.type="date",h.id="bilan-date",h.name="date",o.appendChild(s),o.appendChild(h);const g=document.createElement("div");g.className="bilan-content",g.id="bilan-content";const t=document.createElement("button");return t.className="copy-button",t.textContent="Copier dans le presse-papier",t.id="copy-button",e.appendChild(r),e.appendChild(n),e.appendChild(o),e.appendChild(g),e.appendChild(t),e}function A({onPeriodChange:e}){return r=>{const n=r.target,a=n.dataset.period;a&&(document.querySelectorAll(".period-button").forEach(c=>{c.classList.remove("active")}),n.classList.add("active"),e(a))}}function F({onDateChange:e}){return r=>{const a=r.target.value;if(!a)return;const[c,l,o]=a.split("-").map(Number),s=new Date(c,l-1,o);e(s)}}function I({onCopy:e}){return r=>{r.preventDefault(),e()}}function H({moods:e,moodOptions:r,period:n,date:a,startDate:c,endDate:l}){if(e.length===0)return"Aucune donn√©e disponible pour cette p√©riode.";let o;if(n==="day")o=`Jour - ${a.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}`;else if(n==="week"&&c&&l){const t=c.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),d=l.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});o=`Semaine - du ${t} au ${d}`}else if(n==="month"&&c&&l){const t=c.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),d=l.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});o=`Mois - du ${t} au ${d}`}else{const t=a.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});o=n==="week"?`Semaine - ${t}`:`Mois - ${t}`}let s=`Bilan ${o}
`;s+="=".repeat(50)+`

`;const h={1:0,2:0,3:0,4:0,5:0};e.forEach(t=>{h[t.note]=(h[t.note]||0)+1}),r.sort((t,d)=>d.value-t.value).forEach(t=>{const d=h[t.value]||0;s+=`${t.emoji} ${t.value} - ${t.label} | S√©lectionn√© ${d} fois
`}),s+=`
`+"=".repeat(50)+`
`,s+=`Total : ${e.length} mood${e.length>1?"s":""}
`;const g=e.reduce((t,d)=>t+d.note,0)/e.length;return s+=`Moyenne : ${g.toFixed(2)}/5
`,s}function R({moods:e,moodOptions:r,period:n,date:a,startDate:c,endDate:l}){const o=document.getElementById("bilan-content");if(!o)return;if(o.innerHTML="",e.length===0){const i=document.createElement("p");i.className="empty-message",i.textContent="Aucune donn√©e disponible pour cette p√©riode",o.appendChild(i);return}let s;if(n==="day")s=`Jour - ${a.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"})}`;else if(n==="week"&&c&&l){const i=c.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),m=l.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});s=`Semaine - du ${i} au ${m}`}else if(n==="month"&&c&&l){const i=c.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),m=l.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});s=`Mois - du ${i} au ${m}`}else{const i=a.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});s=n==="week"?`Semaine - ${i}`:`Mois - ${i}`}const h=document.createElement("h2");h.textContent=`Bilan ${s}`,o.appendChild(h);const g=document.createElement("div");g.className="bilan-stats";const t=document.createElement("div");t.className="stat-item",t.innerHTML=`<strong>Total :</strong> ${e.length} mood${e.length>1?"s":""}`;const d=e.reduce((i,m)=>i+m.note,0)/e.length,y=document.createElement("div");y.className="stat-item",y.innerHTML=`<strong>Moyenne :</strong> ${d.toFixed(2)}/5`,g.appendChild(t),g.appendChild(y),o.appendChild(g);const u=P({moods:e,moodOptions:r});o.appendChild(u);const p=document.createElement("div");p.className="bilan-list",e.sort((i,m)=>new Date(i.datetime)-new Date(m.datetime)),e.forEach(i=>{const m=r.find(M=>M.value===i.note),v=m?m.emoji:"‚ùì",E=m?m.label:"",S=m?m.color:"#ccc",b=new Date(i.datetime),$=b.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),w=b.toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),C=document.createElement("div");C.className="bilan-item",C.style.borderLeftColor=S;const f=document.createElement("div");f.className="bilan-mood",f.innerHTML=`${v} ${i.note} - ${E}`;const L=document.createElement("div");L.className="bilan-datetime",L.textContent=`${$} √† ${w}`,C.appendChild(f),C.appendChild(L),p.appendChild(C)}),o.appendChild(p)}function T({onNavigate:e}){document.querySelectorAll(".nav-link").forEach(n=>{n.addEventListener("click",a=>{a.preventDefault();const c=a.target,l=c.textContent==="Accueil"?"/":c.textContent==="Mes Moods"?"/list":c.textContent==="Bilans"?"/bilans":"/";e(l)})})}function j(){const e=document.getElementById("bilan-date");if(e){const r=new Date,n=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),c=String(r.getDate()).padStart(2,"0");e.value=`${n}-${a}-${c}`}}function P({moods:e,moodOptions:r}){const n=document.createElement("div");if(n.className="pie-chart-container",e.length===0)return n;const a={1:0,2:0,3:0,4:0,5:0};e.forEach(u=>{a[u.note]=(a[u.note]||0)+1});const c=r.filter(u=>a[u.value]>0).map(u=>({value:u.value,label:u.label,emoji:u.emoji,color:u.color,count:a[u.value],percentage:a[u.value]/e.length*100}));if(c.length===0)return n;const l=document.createElement("h3");l.textContent="R√©partition des moods",l.className="chart-title",n.appendChild(l);const o=document.createElement("div");o.className="pie-chart-wrapper";const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox","0 0 200 200"),s.setAttribute("width","200"),s.setAttribute("height","200"),s.setAttribute("class","pie-chart");const h=100,g=100,t=80;let d=-90;c.forEach((u,p)=>{const i=u.percentage/100*360,m=d,v=d+i,E=h+t*Math.cos(m*Math.PI/180),S=g+t*Math.sin(m*Math.PI/180),b=h+t*Math.cos(v*Math.PI/180),$=g+t*Math.sin(v*Math.PI/180),w=i>180?1:0,C=[`M ${h} ${g}`,`L ${E} ${S}`,`A ${t} ${t} 0 ${w} 1 ${b} ${$}`,"Z"].join(" "),f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d",C),f.setAttribute("fill",u.color),f.setAttribute("stroke","white"),f.setAttribute("stroke-width","2"),f.setAttribute("class","pie-segment"),f.setAttribute("data-value",String(u.value)),s.appendChild(f),d+=i}),o.appendChild(s);const y=document.createElement("div");return y.className="pie-chart-legend",c.forEach(u=>{const p=document.createElement("div");p.className="legend-item";const i=document.createElement("div");i.className="legend-color",i.style.backgroundColor=u.color;const m=document.createElement("div");m.className="legend-text",m.innerHTML=`${u.emoji} <strong>${u.label}</strong> (${u.count}) - ${u.percentage.toFixed(1)}%`,p.appendChild(i),p.appendChild(m),y.appendChild(p)}),o.appendChild(y),n.appendChild(o),n}function D({message:e}){var c;const r=document.querySelector(".copy-message");r&&r.remove();const n=document.createElement("div");n.className="copy-message",n.textContent=e;const a=document.getElementById("copy-button");a&&((c=a.parentElement)==null||c.insertBefore(n,a),setTimeout(()=>{n.remove()},3e3))}async function O({root:e,params:r,deps:n}){e.innerHTML="";const a=x(),c=k();e.appendChild(a),e.appendChild(c),j();let l="day",o=new Date;const s=async()=>{let t,d,y;if(l==="day")t=await n.moodsUseCase.getByDate({date:o});else if(l==="week"){const p=new Date(o),i=p.getDay(),m=i===0?-6:1-i;p.setDate(p.getDate()+m),p.setHours(0,0,0,0),d=new Date(p);const v=new Date(p);v.setDate(v.getDate()+6),v.setHours(23,59,59,999),y=new Date(v),t=await n.moodsUseCase.getByWeek({weekStart:p})}else{const p=new Date(o.getFullYear(),o.getMonth(),1);p.setHours(0,0,0,0),d=new Date(p);const i=new Date(o.getFullYear(),o.getMonth()+1,0);i.setHours(23,59,59,999),y=new Date(i),t=await n.moodsUseCase.getByMonth({monthStart:p})}R({moods:t,moodOptions:N.moodOptions,period:l,date:o,startDate:d,endDate:y});const u=document.getElementById("copy-button");if(u){const p=I({onCopy:async()=>{const i=H({moods:t,moodOptions:N.moodOptions,period:l,date:o,startDate:d,endDate:y});try{await navigator.clipboard.writeText(i),D({message:B.copySuccess})}catch(m){console.error("Erreur lors de la copie:",m),D({message:B.copyError})}}});u.addEventListener("click",p)}};document.querySelectorAll(".period-button").forEach(t=>{const d=A({onPeriodChange:y=>{l=y,s()}});t.addEventListener("click",d)});const g=document.getElementById("bilan-date");if(g){const t=F({onDateChange:d=>{o=d,s()}});g.addEventListener("change",t)}await s(),T({onNavigate:t=>{const d=window.router;d&&d.navigate(t)}})}export{O as renderBilansPage};
